#!/bin/bash
# Bash aliases configuration

# Function to conditionally replace commands with better alternatives
__add_command_replace_alias() {
    if command -v "$2" &>/dev/null; then
        alias "$1"="$2"
    fi
}

# Command replacements (if available)
__add_command_replace_alias man 'tldr'
__add_command_replace_alias df 'pydf'

# System information
alias timer='echo "Timer started. Stop with Ctrl-D." && date && time cat && date'


# Navigation
alias cd.='cd ..'
alias cd..='cd ..'
alias cd-='cd -'


# ls variants
alias ls='eza'
alias ll='eza -lh'
alias la='eza -a'
alias l='eza'
alias lt='eza -r -s modified'  # Sort by time, newest last

# git
alias gitst='git st'
alias gits='git st'
alias gitst.='git st .'

# Safety nets
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias mkdir='mkdir -pv'

# Editor shortcuts
alias s='execute_latest_appimage cursor'
alias sgo='execute_latest_appimage cursor -g'
alias claude-danger='claude --dangerously-skip-permissions'
alias claude-carto-danger='claude-carto --dangerously-skip-permissions'


# Search tools
if command -v fdfind &>/dev/null; then
    alias fd='fdfind'
fi
alias busca='fd'
alias fzfp="fzf --preview='bat --color=always --line-range :500 {}'"
alias hist='cat ~/.bash_history | fzf'
alias h='cat ~/.bash_history | fzf '
fzf_find_edit() {
    local file=$(
      fzf --query="$1" --no-multi --select-1 --exit-0 \
          --preview 'bat --color=always --line-range :500 {}'
    )
    if [[ -n "$file" ]]; then
        $EDITOR "$file"
    fi
}
alias fe='fzf_find_edit'
fzf_change_directory() {
    local directory=$(
      fd --type d | \
        fzf --query="$1" --no-multi --select-1 --exit-0 \
            --preview 'tree -C {} | head -100'
    )
    if [[ -n $directory ]]; then
        cd "$directory"
    fi
}
alias fcd='fzf_change_directory'
fzf_git_add() {
    local selections=$(
      git ls-files -m -o --exclude-standard | \
        fzf --ansi \
            --preview 'if (git ls-files --error-unmatch {1} &>/dev/null); then
                           git diff --color=always {1}
                       else
                           bat --color=always --line-range :500 {1}
                       fi'
    )
    if [[ -n $selections ]]; then
        git add --verbose $selections
    fi
}
alias gadd='fzf_git_add'
alias batp='bat -p'
alias batf="fzf --bind 'enter:become(bat {})'"
alias agsql='ag --sql'
alias agpy='ag --python'
alias agmd='ag --markdown'
alias agi='ag -i'

# Clipboard
alias clip='xclip -selection clipboard'
alias paste='xclip -selection clipboard -o'
alias cwd='echo -n ${PWD/#$HOME/\~} | tr -d "\r\n" | xclip -selection clipboard -i'

# SSH
alias sshpro='eval $(ssh-agent); ssh-add'
alias ssh='ssh -A'

# Grin patterns
alias grinp='grin -I "*.py"'
alias grinh='grin -I "*.html"'
alias grinurls='grin -I "urls.py"'
alias grina='grin -I "admin.py"'
alias grinpo='grin -I "*.po"'

# Version control - Mercurial
alias hs='hg status'
alias hsum='hg summary'
alias hcm='hg commit -m'

# dbt
alias dbt-show-deps='dbt list --resource-type model --resource-type source --select'
alias dbt-fix-schemas='dbt-osmosis yaml refactor'

# Docker shortcuts
alias dk='docker'
alias dc='docker-compose'
alias dctail='docker-compose logs -f'
alias dkps='docker ps'
alias dkpsa='docker ps -a'
alias dki='docker images'
alias dklc='docker ps -l'
alias dklcid='docker ps -l -q'
alias dklcip='docker inspect -f "{{.NetworkSettings.IPAddress}}" $(docker ps -l -q)'
alias dkrmac='docker rm $(docker ps -a -q)'
alias dkstac='docker ps -q | xargs -r docker stop'

# Kubernetes
alias k='kubectl'
alias kga='kubectl get all --show-labels'
alias kls='kubectl get pods --show-labels'
alias klsa='kubectl get pod --all-namespaces'
alias kdp='kubectl describe pod'
alias kgrep='kubectl get pods --show-labels | grep'
alias kexec='kubectl exec -it'
alias kns='kubens'

# System management
alias reboot='sudo shutdown -r now'
alias shutdown='sudo shutdown -h now'
alias paux='ps aux | grep'

# Networking
alias ports='netstat -tulanp'
alias ports-listen='sudo lsof -nP -iTCP -sTCP:LISTEN'

# Function to execute latest AppImage
execute_latest_appimage() {
    local program="$1"
    local directory="${HOME}/bin"
    local latest_appimage

    # Use case-insensitive pattern matching
    shopt -s nocaseglob
    latest_appimage=$(ls -t "${directory}"/*"${program}"*.AppImage 2>/dev/null | head -n 1)
    shopt -u nocaseglob

    if [ -n "$latest_appimage" ] && [ -f "$latest_appimage" ]; then
        echo "Executing: $(basename "$latest_appimage")"
        chmod +x "$latest_appimage"
        "$latest_appimage" "${@:2}"
    else
        echo "No AppImage found for '${program}' in ${directory}"
        return 1
    fi
}

# AppImage aliases
alias cursor='execute_latest_appimage cursor'
